================================================================================
Canonical Frontend 项目历史时间线
Project Timeline: Canonical Spec - 统一需求编译与执行入口系统
================================================================================

本文档记录了 Canonical Frontend 项目从立项、需求分析到当前实现阶段的完整历史，
基于 Git 提交记录、文档变更和项目演进过程整理而成。

数据来源：
- Git 提交历史 (canonical_frontend/.git, feishu-onboarding-tool/.git)
- 项目文档 (docs/)
- README 和 CHANGELOG 变更记录
- 前置项目信息 (feishu-onboarding-tool, RequirementDocGen)

================================================================================
项目概述
================================================================================

项目名称：Canonical Spec - 统一需求编译与执行入口系统
项目目标：将任意质量的需求输入（从一句话到完整文档）编译成可执行的最小任务集，
         并发布到执行系统（如飞书多维表格）

核心价值：
1. 接受任意质量的输入（从一句话到完整任务文档）
2. 自动判断：是否信息充分、是否值得进入执行系统
3. 如果信息不足：主动进入多轮澄清，每轮只聚焦一个需求
4. 最终只在满足条件时：产出可执行的最小任务集，并进入团队的执行系统
5. 如果不满足：给出 Hold / Drop 的明确理由，而不是模糊失败

项目演进路径：
Canonical Frontend 项目并非从零开始，而是整合了两个前置项目的核心能力：
1. feishu-onboarding-tool：提供 Feishu 多维表格集成和发布能力
2. RequirementDocGen：提供 AI 驱动的需求分析和多轮澄清能力
3. Canonical Spec：统一两者，形成完整的需求编译与执行入口系统

================================================================================
前置项目历史
================================================================================

【前置项目一：feishu-onboarding-tool】
项目地址：https://github.com/369795172/feishu-onboarding-tool.git
项目定位：独立的飞书多维表格onboarding需求自动创建工具，支持多项目接入和Web UI界面

2026年1月12日 - 项目初始提交
提交ID: c3ff9b0
提交者: marviny
提交信息: [Cursor] 初始提交：飞书Onboarding需求创建工具完整实现

关键内容：
- 完整的飞书多维表格集成工具
- 支持为新入职员工自动创建6条onboarding需求记录
- 自动查询用户ID功能（通过姓名/邮箱/手机号）
- 多项目支持（通过配置文件管理）
- Web UI界面（Vue 3 + TypeScript）
- Docker容器化部署支持

新增文件（50个文件，3173行代码）：
- 后端：FastAPI应用（backend/app/）
  * api/demands.py - 需求创建API（169行）
  * api/projects.py - 项目管理API（51行）
  * api/users.py - 用户查询API（137行）
  * services/demand_service.py - 需求服务（165行）
  * utils/feishu_bitable_client.py - Feishu客户端（252行）
  * utils/feishu_user_cache.py - 用户ID缓存（85行）
  * config/project_manager.py - 项目管理器（95行）
  * config/template_loader.py - 模板加载器（87行）

- 前端：Vue 3应用（frontend/）
  * src/App.vue - 主应用组件
  * src/views/DemandCreate.vue - 需求创建视图（233行）
  * src/api/ - API客户端（demands.ts, projects.ts, users.ts）

- 配置：项目配置和需求模板（config/）
  * projects/inputbaby.yaml - InputBaby项目配置
  * demands/backend.yaml - Backend角色需求模板（151行）

- 文档：完整的使用文档（docs/）
  * api.md - API文档（138行）
  * docker.md - Docker部署文档（334行）
  * setup.md - 设置文档（106行）

核心能力：
- Feishu多维表格API集成
- 需求记录自动创建
- 用户ID自动查询和缓存
- 多项目配置管理
- 需求模板系统

2026年1月13日 - Docker部署文档完善
提交ID: 59cc36e
提交信息: [Cursor] 更新README：完善Docker容器化部署文档

关键内容：
- 完善README文档（+153行）
- 添加Docker部署详细说明
- 添加环境变量配置说明
- 添加常见问题解答

2026年1月14日 - 文档和工具脚本添加
提交ID: 90715bc
提交信息: [Cursor] Add onboarding documentation and utility scripts from InputBaby project

关键内容：
- 添加onboarding需求文档（8个文件，2393行）
  * onboarding_demands_api_usage.md - API使用文档（198行）
  * onboarding_demands_automation_roadmap.md - 自动化路线图（459行）
  * onboarding_demands_cross_role_playbook.md - 跨角色手册（360行）
  * onboarding_demands_phase_b_implementation_guide.md - Phase B实施指南（740行）
  * onboarding_demands_phase_b_status.md - Phase B状态（91行）
  * onboarding_demands_split.md - 需求拆分文档（220行）
- 添加工具脚本
  * onboarding_demands_csv_template.py - CSV模板生成器（298行）
  * test_csv_format.py - CSV格式测试（27行）

2026年1月14日 - 敏感信息清理
提交ID: a405fd8
提交信息: [Cursor] Remove sensitive information from documentation

关键内容：
- 清理文档中的敏感信息
- 更新API使用文档
- 更新Phase B实施指南和状态文档

项目贡献：
- 为Canonical Frontend提供了Feishu集成能力
- 提供了需求发布到执行系统的完整流程
- 提供了多项目配置管理经验
- 提供了Web UI界面设计参考

【前置项目二：RequirementDocGen】
项目地址：https://github.com/369795172/RequirementDocGen.git
项目定位：AI驱动的需求文档生成系统，基于Active Learning框架

项目特性：
- 智能需求分析：Input-Analysis-Clarification-Documentation循环
- 自然语言输入：支持语音或文本输入
- AI理解：使用Gemini 3 Flash理解和解析需求
- 多轮澄清：自动识别歧义并提问
- 结构化输出：生成JSON需求文档
- Requirement Genome管理：实时需求理解总结
- 语音驱动交互：集成AI Builder Space语音转文本API
- 高性能工程：异步处理、指数退避重试

技术栈：
- 后端：FastAPI (Python)
- 前端：React + Vite
- AI引擎：AI Builder Space Platform
  * Gemini 3 Flash Preview (Thinking Mode) - 需求分析和澄清
  * Audio Transcription API - 实时语音转文本
- 图标：Lucide React

项目贡献：
- 为Canonical Frontend提供了AI驱动的需求分析能力
- 提供了多轮澄清的工作流程
- 提供了语音输入和转录功能
- 提供了Requirement Genome概念的基础
- 提供了深色主题UI设计参考

【项目整合：Canonical Spec设计阶段】

根据技术设计文档（canoncial_technical_design.md）的描述：
- RequirementDocGen：主要覆盖 ORCH + COMP + VALID + PLAN + VV + SPEC/MEM/EVID（偏"澄清/编译"）
- feishu-onboarding-tool：主要覆盖 MAP + PUB + Feishu Adapter + LEDGER（偏"发布/落库"）
- Canonical Spec整合目标：
  1. 把两者统一到Canonical Spec（SPEC）
  2. 把"缺信息→澄清"变成Gate驱动（VALID + ORCH）
  3. 添加CLI命令入口，实现Pipeline Orchestrator

整合设计文档：
- docs/canonical_spec.md - 业务基线文档（用户故事级）
- docs/canoncial_technical_design.md - 技术架构设计（3个核心协议 + Gate规则）

================================================================================
时间线（按时间顺序）
================================================================================

【2026年1月21日 - Canonical Frontend项目启动与基础架构搭建】

08:35:59 - 初始提交：项目重建与核心实现
提交ID: 2678d5c
提交者: marviny
提交信息: [Cursor] Rebuild repo: Add documentation and Python implementation

关键内容：
- 完成 MVP 合同文档（6份文档，采用六要素契约模式）
- Python 实现代码（CLI、引擎、模型、存储、适配器）
- 项目结构：docs/ 用于规范文档，canonical/ 用于代码
- README 更新，覆盖文档和代码结构

新增文件（28个文件，6253行代码）：
- 文档层：
  * docs/canonical_spec.md - 业务基线文档（用户故事级）
  * docs/canoncial_technical_design.md - 技术架构设计（730行）
  * docs/mvp_contracts/ - 6份MVP合同文档
    - 00_scope_and_terms.md - MVP范围、术语表、状态机
    - 01_canonical_spec_mvp_schema.md - Canonical Spec MVP Schema
    - 02_gate_model.md - Gate模型（硬必填+加权评分）
    - 03_orchestrator_steps_io.md - Orchestrator Steps I/O（9步编排流程）
    - 04_feishu_publish_contract.md - Feishu发布契约
    - 05_review_checklist.md - 开工前检查清单
    - 06_mvp_integration_matrix.md - MVP集成矩阵

- 代码层：
  * canonical/cli.py - CLI命令入口（398行）
  * canonical/engine/compiler.py - LLM编译器（462行）
  * canonical/engine/gate.py - Gate引擎（497行）
  * canonical/engine/orchestrator.py - Pipeline编排器（541行）
  * canonical/models/ - 数据模型（spec.py, gate.py, snapshot.py）
  * canonical/store/ - 存储层（spec_store.py, snapshot_store.py, ledger.py）
  * canonical/adapters/feishu.py - Feishu适配器（523行）

定义完成度：100%
实施状态：核心契约已清晰，验证要求已定义，代码实现已完成

22:25:05 - 修复与配置更新
提交ID: a0d17da
提交信息: [Cursor] Fix canonical spec publishing and update Feishu configuration

关键内容：
- 修复 canonical spec 发布功能
- 更新 Feishu 配置
- 完善编译器逻辑（compiler.py +9行）
- 完善编排器逻辑（orchestrator.py +10行）
- 添加环境变量示例（env.example +25行）

22:44:30 - React 前端界面实现
提交ID: 362c34f
提交信息: [Cursor] Add React frontend for Canonical Spec Manager

关键内容：
- 添加 React 前端应用
- 创建前端项目结构（index.html, package.json, vite.config.js）
- 实现主应用组件（src/App.jsx - 445行）
- 实现样式文件（src/App.css - 687行）
- 前端入口文件（src/main.jsx）

新增文件（6个文件，1198行代码）：
- index.html - HTML入口
- package.json - 项目依赖配置
- vite.config.js - Vite构建配置
- src/App.jsx - React主组件
- src/App.css - 样式文件
- src/main.jsx - 应用入口

【2026年1月22日 - 功能增强与用户体验优化】

09:26:18 - FastAPI 服务器与深色主题前端
提交ID: 5581cd2
提交信息: [Cursor] Add FastAPI server and dark theme frontend with voice input

关键内容：
- 添加 FastAPI 后端服务器（canonical/api.py - 190行）
- 实现深色主题前端界面
- 添加语音输入功能
- 编译器增强（compiler.py +28行）
- 添加变更日志（CHANGELOG.md - 68行）
- 添加 API 文档（README_API.md - 64行）
- 更新依赖（requirements.txt +21行）
- 添加启动脚本（start_api.sh）

新增功能：
- 深色主题 UI 设计
- 实时音频录制（MediaRecorder API）
- 波形可视化
- 音频转录支持
- FastAPI 后端接口

文件变更：
- src/App.css - 完全重写（841行，深色主题）
- src/App.jsx - 添加语音录制和布局重构（383行新增）
- canonical/api.py - 新增 FastAPI 服务器
- requirements.txt - 添加 FastAPI 和 uvicorn 依赖

13:34:32 - Feishu 用户故事模板增强
提交ID: b52ca52
提交信息: [Cursor] feat(canonical): add background field to Feishu user story template

关键内容：
- 添加背景字段到 Feishu 用户故事模板
- 更新 Feishu 发布契约文档
- 添加工具使用指南（canonical_spec_tool_guide.md - 116行）

16:31:12 - CLI 文件输入支持
提交ID: 8fe2146
提交信息: [Cursor] feat(cli): 添加 --input 选项支持从文件读取需求描述

关键内容：
- CLI 工具添加 --input 选项
- 支持从文件读取需求描述
- 增强命令行接口功能（cli.py +35行）

16:57:00 - 忽略规则更新
提交ID: e9495f1
提交信息: [Cursor] chore: 添加 inputs/ 目录到 .gitignore

关键内容：
- 添加 inputs/ 目录到 .gitignore
- 更新版本控制忽略规则（.gitignore +18行）

22:23:50 - 音频转录功能实现
提交ID: 77703a0
提交信息: [Cursor] Implement audio transcription using AI Builder Space API

关键内容：
- 实现音频转录功能（使用 AI Builder Space API）
- 添加 AI 客户端服务（canonical/services/ai_client.py - 77行）
- 更新 API 接口（api.py +55行）
- 更新配置管理（config.py +7行）
- 更新环境变量示例（env.example +4行）
- 更新 API 文档（README_API.md +13行）
- 添加依赖（requirements.txt +1行）

新增文件：
- canonical/services/__init__.py
- canonical/services/ai_client.py - AI 客户端服务

23:01:34 - 多轮澄清功能
提交ID: 1038c21
提交信息: [Cursor] Add multi-round clarification feature

关键内容：
- 添加多轮澄清功能
- API 接口增强（api.py +48行）
- 前端样式更新（App.css +84行）
- 前端功能增强（App.jsx +89行）

新增功能：
- 多轮需求澄清
- 澄清问题生成
- 答案应用机制
- UI 交互优化

【2026年1月23日 - 智能需求细化功能】

11:09:32 - LLM 驱动的需求细化功能
提交ID: a8135b1
提交信息: [Cursor] Add LLM-driven requirement refinement feature

关键内容：
- 添加 LLM 驱动的需求细化功能
- 实现细化引擎（canonical/engine/refiner.py - 316行）
- 添加细化模型（canonical/models/refine.py - 55行）
- 编排器增强（orchestrator.py +166行）
- API 接口扩展（api.py +129行）
- 前端功能扩展（App.jsx +224行）
- 添加测试指南（TESTING_GUIDE.md - 200行）

新增文件：
- canonical/engine/refiner.py - 需求细化引擎
- canonical/models/refine.py - 细化数据模型
- TESTING_GUIDE.md - 测试指南文档

功能特性：
- LLM 驱动的需求理解总结
- 自动生成细化问题
- 多轮细化流程
- 需求背景信息累积

16:56:52 - 配置自动初始化
提交ID: 9cfa614
提交信息: [Cursor] Auto-initialize project_record_id from config defaults

关键内容：
- 自动从配置默认值初始化 project_record_id
- 编译器增强（compiler.py +11行）
- 简化配置流程

【2026年1月26日 - 需求演进追踪与 API 完善】

20:42:13 - 需求基因组功能
提交ID: 0d61fb8
提交信息: [Cursor] Add Requirement Genome feature for requirement evolution tracking

关键内容：
- 添加需求基因组（Requirement Genome）功能
- 实现需求演进追踪
- 添加基因组模型（canonical/models/genome.py - 96行）
- 细化引擎增强（refiner.py +83行）
- 细化模型扩展（refine.py +7行）
- 添加需求演进设计文档（requirement_evolution_design.md - 577行）
- 添加实施计划（requirement_evolution_implementation_plan.md - 91行）
- 添加合同文档（07_requirement_genome_contract.md - 112行）
- 前端组件新增（GenomeChanges.jsx - 74行，GenomeStatus.jsx - 84行）
- 前端样式更新（App.css +72行）
- 前端功能扩展（App.jsx +150行）

新增文件：
- canonical/models/genome.py - 需求基因组模型
- docs/requirement_evolution_design.md - 需求演进设计规范
- docs/requirement_evolution_implementation_plan.md - 实施计划
- docs/mvp_contracts/07_requirement_genome_contract.md - 基因组合同文档
- src/components/GenomeChanges.jsx - 变更展示组件
- src/components/GenomeStatus.jsx - 状态展示组件

功能特性：
- 需求版本化追踪
- 历史变更对比
- 背景信息结构化存储
- 轮次和状态可视化

20:57:11 - API 实现与文档同步
提交ID: a40bae8
提交信息: [Cursor] Update API implementation to match documentation

关键内容：
- 更新 API 实现以匹配文档
- 添加 API 状态文档（api_status.md - 187行）
- 添加后端 API 契约文档（backend_api_contract.md - 829行）
- 更新 README_API.md
- API 实现调整（api.py +2行）
- 前端微调（App.jsx +2行）

新增文档：
- docs/api_status.md - API 状态文档
- docs/backend_api_contract.md - 后端 API 契约文档（829行）

21:13:15 - UI 约束澄清
提交ID: d19f5fe
提交信息: [Cursor] Clarify UI constraints in contracts

关键内容：
- 在合同文档中澄清 UI 约束
- 更新范围与术语文档（00_scope_and_terms.md +1行）
- 更新编排器步骤文档（03_orchestrator_steps_io.md +4行）
- 更新需求基因组合同（07_requirement_genome_contract.md +4行）
- 更新需求演进设计文档（requirement_evolution_design.md +7行）

================================================================================
项目演进阶段总结
================================================================================

【阶段零：前置项目开发（2026-01-12 至 2026-01-14）】
- feishu-onboarding-tool：完成飞书多维表格集成工具开发
- RequirementDocGen：完成AI驱动的需求文档生成系统开发
- 两个项目各自独立运行，解决不同层面的问题

【阶段一：项目整合与基础架构（2026-01-21）】
- 基于两个前置项目的经验，设计Canonical Spec统一架构
- 完成项目重建，建立完整的文档体系和代码架构
- 实现核心 MVP 合同文档（6份）
- 完成 Python 核心实现（CLI、引擎、模型、存储、适配器）
- 整合feishu-onboarding-tool的Feishu集成能力
- 整合RequirementDocGen的AI分析和澄清能力
- 定义完成度达到 100%

【阶段二：前端界面开发（2026-01-21 晚）】
- 添加 React 前端应用
- 实现 FastAPI 后端服务器
- 实现深色主题 UI 设计
- 添加语音输入功能

【阶段三：功能增强（2026-01-22）】
- 实现音频转录功能（AI Builder Space API）
- 添加多轮澄清功能
- 增强 CLI 工具（文件输入支持）
- 完善 Feishu 集成（背景字段）

【阶段四：智能需求细化（2026-01-23）】
- 实现 LLM 驱动的需求细化功能
- 添加需求细化引擎
- 实现多轮细化流程
- 添加测试指南

【阶段五：需求演进追踪（2026-01-26）】
- 实现需求基因组（Requirement Genome）功能
- 添加需求演进追踪机制
- 完善 API 文档和契约
- 澄清 UI 约束

================================================================================
技术栈演进
================================================================================

后端技术栈：
- Python 3.x
- FastAPI（Web 框架）
- SQLAlchemy（数据模型，如需要）
- LLM API 集成（OpenAI/其他）

前端技术栈：
- React
- Vite（构建工具）
- Lucide React（图标库）
- MediaRecorder API（音频录制）
- AudioContext API（音频处理）

核心架构：
- CLI 工具（canonical/cli.py）
- 引擎层（compiler.py, gate.py, orchestrator.py, refiner.py）
- 数据模型（spec.py, gate.py, snapshot.py, refine.py, genome.py）
- 存储层（spec_store.py, snapshot_store.py, ledger.py）
- 适配器层（feishu.py）
- API 服务（api.py）
- AI 服务（ai_client.py）

================================================================================
文档体系
================================================================================

核心规范文档：
1. canonical_spec.md - 业务基线文档（用户故事级，226行）
2. canoncial_technical_design.md - 技术架构设计（730行）

MVP 合同文档（7份）：
1. 00_scope_and_terms.md - MVP范围、术语表、状态机
2. 01_canonical_spec_mvp_schema.md - Canonical Spec MVP Schema
3. 02_gate_model.md - Gate模型
4. 03_orchestrator_steps_io.md - Orchestrator Steps I/O
5. 04_feishu_publish_contract.md - Feishu发布契约
6. 05_review_checklist.md - 开工前检查清单
7. 06_mvp_integration_matrix.md - MVP集成矩阵
8. 07_requirement_genome_contract.md - 需求基因组合同

其他文档：
- requirement_evolution_design.md - 需求演进设计规范（577行）
- requirement_evolution_implementation_plan.md - 实施计划（91行）
- api_status.md - API 状态文档（187行）
- backend_api_contract.md - 后端 API 契约文档（829行）
- canonical_spec_tool_guide.md - 工具使用指南（116行）
- TESTING_GUIDE.md - 测试指南（200行）
- CHANGELOG.md - 变更日志
- README_API.md - API 文档

================================================================================
代码统计
================================================================================

总提交数：14个提交
时间跨度：2026-01-21 至 2026-01-26（6天）

主要文件统计（基于提交记录）：
- Python 代码：约 4000+ 行
- React 前端代码：约 2000+ 行
- 文档：约 3000+ 行
- 配置文件：package.json, requirements.txt, vite.config.js 等

核心模块代码量：
- canonical/cli.py - 398行
- canonical/engine/compiler.py - 490行（初始462 + 后续28）
- canonical/engine/gate.py - 497行
- canonical/engine/orchestrator.py - 717行（初始541 + 后续166）
- canonical/engine/refiner.py - 399行（初始316 + 后续83）
- canonical/adapters/feishu.py - 523行
- canonical/api.py - 516行（初始190 + 后续326）
- canonical/models/ - 约 600行
- canonical/store/ - 约 800行
- src/App.jsx - 约 1000行（累计）
- src/App.css - 约 1000行（累计）

================================================================================
关键里程碑
================================================================================

✅ 2026-01-21 08:35 - 项目启动，完成基础架构
✅ 2026-01-21 22:44 - React 前端界面实现
✅ 2026-01-22 09:26 - FastAPI 服务器与深色主题前端
✅ 2026-01-22 22:23 - 音频转录功能实现
✅ 2026-01-22 23:01 - 多轮澄清功能
✅ 2026-01-23 11:09 - LLM 驱动的需求细化功能
✅ 2026-01-26 20:42 - 需求基因组功能
✅ 2026-01-26 20:57 - API 文档完善
✅ 2026-01-26 21:13 - UI 约束澄清

================================================================================
项目当前状态
================================================================================

定义完成度：✅ 100%
- 所有 MVP 合同文档已完成（7份）
- 每层契约六要素已定义
- 关键定义（Gate硬必填、加权评分、状态机、Feishu映射、幂等性）已明确

实施完成度：✅ 核心功能已完成
- Phase 1：核心数据结构实现 ✅
- Phase 2：Gate Engine实现 ✅
- Phase 3：Orchestrator实现 ✅
- Phase 4：Feishu集成 ✅
- Phase 5：CLI工具实现 ✅
- Phase 6：React前端实现 ✅
- Phase 7：FastAPI服务器 ✅
- Phase 8：音频转录功能 ✅
- Phase 9：多轮澄清功能 ✅
- Phase 10：LLM需求细化 ✅
- Phase 11：需求基因组功能 ✅

可开工性：✅ 是
- 核心契约已清晰
- 验证要求已定义
- 代码实现已完成
- 文档体系完整

================================================================================
数据来源说明
================================================================================

本文档基于以下数据源整理：
1. Git 提交历史：
   - canonical_frontend/.git（14个提交，2026-01-21至2026-01-26）
   - feishu-onboarding-tool/.git（4个提交，2026-01-12至2026-01-14）
   - 使用 git log 命令提取提交信息
   - 包含提交ID、日期、作者、提交信息、文件变更统计

2. 项目文档：
   - canonical_frontend/docs/ 目录下的所有文档
   - canonical_frontend/README.md 和 CHANGELOG.md
   - canonical_frontend/docs/canoncial_technical_design.md（明确提到两个前置项目）
   - 各合同文档和设计文档

3. 前置项目信息：
   - feishu-onboarding-tool：本地Git仓库和GitHub仓库
   - RequirementDocGen：GitHub仓库信息（https://github.com/369795172/RequirementDocGen）

4. 代码文件：
   - canonical_frontend/canonical/ 目录下的 Python 代码
   - canonical_frontend/src/ 目录下的 React 前端代码

5. 限制说明：
   - Cursor chat logs 存储在云端，本地 SQLite 数据库仅包含元数据
   - RequirementDocGen 的详细Git历史未在本地获取，基于GitHub仓库信息
   - 本文档主要基于 Git 提交历史和文档变更记录
   - 部分早期讨论和设计决策可能未完全记录在 Git 历史中
   - 项目整合阶段的具体讨论过程可能未完全记录

================================================================================
文档生成信息
================================================================================

生成时间：2026-01-27
数据来源：
- Git 提交历史（canonical_frontend, feishu-onboarding-tool）
- 项目文档（docs/）
- README 和 CHANGELOG
- 前置项目信息（GitHub仓库）
格式：纯文本 DOC 风格
用途：项目历史记录，用于社区分享和项目回顾

更新说明：
- v1.1：补充前置项目历史（feishu-onboarding-tool, RequirementDocGen）
- 明确了项目演进路径：两个独立项目 → 整合设计 → Canonical Frontend实现

================================================================================