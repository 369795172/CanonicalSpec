# 需求演进功能实施计划（框架版）

## 概述

本文档仅保留关键节点与框架思路，用于在 plan mode 下生成执行方案。实现细节统一参考现有文档，不在此重复展开：

- `docs/requirement_evolution_design.md`
- `docs/mvp_contracts/01_canonical_spec_mvp_schema.md`
- `docs/mvp_contracts/03_orchestrator_steps_io.md`
- `docs/mvp_contracts/04_feishu_publish_contract.md`

---

## 关键节点（Milestones）

### M1：UI 透明化（用户可见）

**目标**：用户能直观看到轮次、历史、草稿预览。  
**范围**：前端展示层，不改变后端结构。  
**输出**：
- 轮次显示
- 对话历史（可折叠）
- `ready_to_compile` 草稿预览

### M2：Requirement Genome（结构化累积）

**目标**：引入 Genome 作为需求演进的唯一事实源。  
**范围**：后端模型与 API 返回结构升级。  
**输出**：
- Genome 版本化
- 每轮累积并可追溯
- API 返回 `genome` + 本轮变更摘要

### M3：演进视图（对比 + 侧边栏）

**目标**：让用户可比较“这一轮 vs 上一轮”。  
**范围**：前端信息架构增强。  
**输出**：
- 侧边栏状态摘要
- 历史轮次切换
- 本轮变更高亮

---

## 依赖关系

- **M1 可独立上线**
- **M2 是 M3 前置**
- **M3 依赖 M1 的 UI 骨架**

---

## 测试案例（人工验收，简版）

> 前端相关必须人工验收，不依赖自动化测试。

### M1
- 轮次是否正确显示（第 1/2/3 轮）
- 历史折叠是否可展开/收起，内容是否完整
- `ready_to_compile` 时草稿预览可见

### M2
- API 返回包含 `genome` 与 `changes`
- `genome_version` 每轮递增且唯一
- Genome 累积字段不丢失（多轮仍可追溯）

### M3
- 侧边栏统计与实际内容一致
- 历史轮次切换后主内容正确切换
- 本轮更新高亮可见

---

## 通过标准（人工验收为主）

### M1 通过标准
- 用户能明确看到轮次、历史、草稿预览
- UI 风格与现有设计一致，无视觉冲突

### M2 通过标准
- Genome 版本不可变且可追溯
- API 返回结构稳定，可用于前端展示

### M3 通过标准
- 用户可感知本轮更新
- 支持查看历史并对比变化

**最终通过条件**：
- M1/M2/M3 全部通过人工验收
- 无 P0/P1 级别问题
- 产品负责人确认“需求演进可被理解与追溯”
